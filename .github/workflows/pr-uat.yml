name: SFDX Test Run on Push

on:
  pull_request:
    branches: [ uat ]

jobs:
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
  
    steps:   
  # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2
    - uses: sfdx-actions/setup-sfdx@v1
      with:
        sfdx-auth-url: ${{ secrets.AUTH_SECRET }}
    - name: 'Convert Metadata'
      run: sfdx force:source:convert --rootdir=force-app --outputdir=convert
    - name: 'Run Test on Metadata'
      run: sfdx force:mdapi:deploy --deploydir=convert --testlevel=RunLocalTests --checkonly -u hub-org 
